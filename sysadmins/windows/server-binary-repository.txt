OMERO.server binary repository
==============================

.. topic:: About

    The OMERO.server binary data repository is a fundamental piece of   
    server-side functionality. It provides optimized and indexed storage of
    original file, pixel and thumbnail data, attachments and full text 
    indexes. Its structure is based on :legacy_plone:`OMEIS <ome-server/system-overview/ome-image-server/>`.

Layout
------

The repository is internally laid out as follows:

::

    C:\OMERO
    C:\OMERO\Pixels      <--- Pixel data
    C:\OMERO\Files       <--- Original file data
    C:\OMERO\Thumbnails  <--- Thumbnail data
    C:\OMERO\FullText    <--- Lucene full text search index

**Your repository is not:**

-  The "database"
-  The directory where your OMERO.server binaries are
-  The directory where your OMERO.client (OMERO.insight, OMERO.editor or OMERO.importer) binaries are
-  Your PostgreSQL data directory

Repository Location
-------------------

.. note::
    It is **strongly** recommended that you make all changes to your OMERO
    binary repository with the server shut down. Changing the
    ``omero.data.dir`` configuration does **not** move the repository for
    you, you must do this yourself.
    Remember that ``C:\`` style paths must have backslashes escaped.

Your repository location can be changed from its ``C:\OMERO`` default by
modifying your OMERO.server configuration as follows:

::

    C:\> cd C:\OMERO.server
    C:\OMERO.server\> bin\omero config set omero.data.dir D:\\OMERO

The suggested procedure is to shut down your OMERO.server instance, move
your repository, change your ``omero.data.dir`` and then start the
instance back up. For example:

::

    C:\> cd C:\OMERO.server
    C:\OMERO.server\> bin\omero admin stop
    C:\OMERO.server\> move C:\OMERO D:\
    C:\OMERO.server\> bin\omero config set omero.data.dir D:\\OMERO
    C:\OMERO.server\> bin\omero admin start

Access Permissions
------------------

Your repository should be owned or accessible by the same user that is
starting your OMERO.server instance.

To modify the access permissions to the binary repository, the :file:`OMERO`
folder properties can be accessed and the permissions settings changed
(see :ref:`windows_repository_perms`). Another option (useful for batch
permission changes) is the :command:`icacls` (Windows 7) / :command:`cacls`
(Windows XP) command line utility. Please note that the new permissions will
appear as `Special Permissions` in the :guilabel:`Security` tab when viewing
folder properties. An example invocation allowing the user `omeservice` to
read (`R`) and write (`W`) from and to the ``OMERO`` directory:

::

    C:\>icacls OMERO /grant omeservice:RW
    processed file: OMERO
    Successfully processed 1 files; Failed processing 0 files

.. _windows_repository_perms:

.. figure:: /images/windows-repository-perms.png
    :align: center

    Repository Folder Permissions

OMERO.server Windows service
----------------------------

Default Windows `Local System` user
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

When no specific Windows user has been defined using :command:`bin\\omero
config set`, the OMERO.server starts as the `Local System` user. This user
has enough permissions to access data on the local file system. In most
circumstances that should allow the OMERO.server service to access data
inside the repository.

Custom user
^^^^^^^^^^^
A custom user can be configured to run the OMERO.server service. You can
configure the OMERO Windows user by setting `omero.windows.user` and
`omero.windows.pass`::

    C:\OMERO.server\> bin\omero config set omero.windows.user USERNAME
    C:\OMERO.server\> bin\omero config set omero.windows.pass PASSWORD

.. warning::

    Setting `omero.windows.pass` exposes your user password in the OMERO
    configuration.

Be sure to also change the `Log On` user in the OMERO.server service
settings. Please consult :ref:`server_service_user_win`. The user credentials
should be the same as used with ``omero.windows.user`` and
``omero.windows.pass``.

.. _server_service_user_win:

.. figure:: /images/server-service-user-win.png
    :align: center

    Windows Service `Log On` User Settings
